<script>
const tree = {
    type: 'root',
    children: [
        {
            type: 'yaml',
            value:
                'title: Hihetetlen megmenekülés a forró kátrány szorításából\nslug: hihetetlen-megmenekueles-a-forro-katrany-szoritasabol-20150109yo\ndate: 2015-01-09 12:00\nteaser: Ez akutya nagyon szerencsés. Egy forró kátránnyal teli gödörbe esett. Még ki tudott mászni, de aztán a kátrány kihűlt és megkötött, a mozgás pedig teljesen lehetetlenné vált számára.',
            position: {
                start: {
                    line: 1,
                    column: 1,
                    offset: 0,
                },
                end: {
                    line: 6,
                    column: 4,
                    offset: 353,
                },
                indent: [1, 1, 1, 1, 1],
            },
            data: {
                parsedValue: {
                    title: 'Hihetetlen megmenekülés a forró kátrány szorításából',
                    slug: 'hihetetlen-megmenekueles-a-forro-katrany-szoritasabol-20150109yo',
                    date: '2015-01-09 12:00',
                    teaser:
                        'Ez a kutya nagyon szerencsés. Egy forró kátránnyal teli gödörbe esett. Még ki tudott mászni, de aztán a kátrány kihűlt és megkötött, a mozgás pedig teljesen lehetetlenné vált számára.',
                },
            },
        },
        {
            type: 'paragraph',
            children: [
                {
                    type: 'link',
                    title: null,
                    url: 'https://www.youtube.com/watch?v=25Jo-DPfYWg',
                    children: [
                        {
                            type: 'text',
                            value: 'https://www.youtube.com/watch?v=25Jo-DPfYWg',
                            position: {
                                start: {
                                    line: 8,
                                    column: 1,
                                    offset: 355,
                                },
                                end: {
                                    line: 8,
                                    column: 44,
                                    offset: 398,
                                },
                                indent: [],
                            },
                        },
                    ],
                    position: {
                        start: {
                            line: 8,
                            column: 1,
                            offset: 355,
                        },
                        end: {
                            line: 8,
                            column: 44,
                            offset: 398,
                        },
                        indent: [],
                    },
                },
            ],
            position: {
                start: {
                    line: 8,
                    column: 1,
                    offset: 355,
                },
                end: {
                    line: 8,
                    column: 44,
                    offset: 398,
                },
                indent: [],
            },
        },
        {
            type: 'paragraph',
            children: [
                {
                    type: 'inlineCode',
                    value: 'youtube: https://www.youtube.com/watch?v=25Jo-DPfYWg',
                    position: {
                        start: {
                            line: 10,
                            column: 1,
                            offset: 400,
                        },
                        end: {
                            line: 10,
                            column: 55,
                            offset: 454,
                        },
                        indent: [],
                    },
                },
            ],
            position: {
                start: {
                    line: 10,
                    column: 1,
                    offset: 400,
                },
                end: {
                    line: 10,
                    column: 55,
                    offset: 454,
                },
                indent: [],
            },
        },
        {
            type: 'paragraph',
            children: [
                {
                    type: 'text',
                    value:
                        'Ekkor találta meg egy járókelő az addigra már teljesen mozgásképtelen kutyust. Szerencsére az állatvédőket hívta, akik gyorsan megtalálták a megkötött kátrány ellenszerét: ',
                    position: {
                        start: {
                            line: 12,
                            column: 1,
                            offset: 456,
                        },
                        end: {
                            line: 12,
                            column: 173,
                            offset: 628,
                        },
                        indent: [],
                    },
                },
                {
                    type: 'strong',
                    children: [
                        {
                            type: 'text',
                            value: 'növényi olaj',
                            position: {
                                start: {
                                    line: 12,
                                    column: 175,
                                    offset: 630,
                                },
                                end: {
                                    line: 12,
                                    column: 187,
                                    offset: 642,
                                },
                                indent: [],
                            },
                        },
                    ],
                    position: {
                        start: {
                            line: 12,
                            column: 173,
                            offset: 628,
                        },
                        end: {
                            line: 12,
                            column: 189,
                            offset: 644,
                        },
                        indent: [],
                    },
                },
                {
                    type: 'text',
                    value: '. Hosszasan mosdatták vele, amíg újra meg nem tisztult a bundája.',
                    position: {
                        start: {
                            line: 12,
                            column: 189,
                            offset: 644,
                        },
                        end: {
                            line: 12,
                            column: 254,
                            offset: 709,
                        },
                        indent: [],
                    },
                },
            ],
            position: {
                start: {
                    line: 12,
                    column: 1,
                    offset: 456,
                },
                end: {
                    line: 12,
                    column: 254,
                    offset: 709,
                },
                indent: [],
            },
        },
        {
            type: 'paragraph',
            children: [
                {
                    type: 'text',
                    value:
                        'A videon megnézhetjük, ahogy a megmentők küzdenek, és persze a végeredményt is - egy nagyon játékos, boldog kutyust!',
                    position: {
                        start: {
                            line: 14,
                            column: 1,
                            offset: 711,
                        },
                        end: {
                            line: 14,
                            column: 117,
                            offset: 827,
                        },
                        indent: [],
                    },
                },
            ],
            position: {
                start: {
                    line: 14,
                    column: 1,
                    offset: 711,
                },
                end: {
                    line: 14,
                    column: 117,
                    offset: 827,
                },
                indent: [],
            },
        },
        {
            type: 'paragraph',
            children: [
                {
                    type: 'text',
                    value:
                        'Tehát ne feledjük, ha kátrány, akkor a növényi olaj oldja! Bárcsak a dohányzók tüdejét is meg lehetne vele tisztítani...',
                    position: {
                        start: {
                            line: 16,
                            column: 1,
                            offset: 829,
                        },
                        end: {
                            line: 16,
                            column: 121,
                            offset: 949,
                        },
                        indent: [],
                    },
                },
            ],
            position: {
                start: {
                    line: 16,
                    column: 1,
                    offset: 829,
                },
                end: {
                    line: 16,
                    column: 121,
                    offset: 949,
                },
                indent: [],
            },
        },
    ],
    position: {
        start: {
            line: 1,
            column: 1,
            offset: 0,
        },
        end: {
            line: 17,
            column: 1,
            offset: 950,
        },
    },
};

import VIdeo from './v-ideo';

const convertNodeType = type => {
    switch (type) {
        case 'root':
            return 'div';
        case 'paragraph':
            return 'p';
        default:
            return type;
    }
};

const isVideoContainer = node => {
    return (
        node.type === 'paragraph' &&
        node.children &&
        node.children[0].type === 'link' &&
        node.children[0].children &&
        node.children[0].children[0].value === node.children[0].url
    );
};

const render = (h, node) => {
    if (!['root', 'paragraph', 'link', 'strong', 'text'].includes(node.type)) {
        console.warn(node.type);
        return '';
    }

    if (node.type === 'text') {
        return node.value;
    }

    // if (node.type === 'link' && node.children[0].type === 'text' && node.url === node.children[0].value) {
    if (isVideoContainer(node)) {
        return h('v-ideo', { attrs: { video: node.children[0].url } }, []);
    }

    return h(convertNodeType(node.type), {}, node.children && node.children.map(n => render(h, n)));
};

export default {
    props: ['tree'],
    render(h) {
        console.log(this.tree);
        return render(h, this.tree);
    },
    components: {
        VIdeo,
    },
};
</script>
